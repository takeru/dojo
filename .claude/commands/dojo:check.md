---
description: "現在のステージの理解度を確認する"
---

# 理解度チェック

現在のステージの評価基準に基づいて、生徒の理解度を確認します。

## 処理手順

1. **現在の状態を確認**
   - `state/progress.json` から `current_course` を取得
   - `courses[current_course].current_stage` から現在のステージ番号を取得

2. **カリキュラムファイルを読み込む**
   - `courses/{current_course}/course.json` を読み込む
   - `stages` 配列から現在のステージ番号に対応する `file` フィールドを取得
   - `courses/{current_course}/curriculum/{file}` を読む

3. **評価基準の確認**
   - カリキュラムの「評価基準」セクションを確認
   - 各項目をチェック

4. **確認方法**
   - 必要に応じて質問を投げかける
   - 生徒にコマンドを実行させて確認
   - コードを見せてもらう

5. **結果の判定**
   - すべての評価基準を満たしていれば「合格」
   - 満たしていなければ、足りない部分を指摘

6. **合格時の処理（重要）**
   - **即座に** `state/progress.json` を更新:
     - `courses[current_course].completed_stages` に現在のステージを追加
     - `courses[current_course].current_stage` を次のステージに更新
     - `last_activity` にタイムスタンプを記録
   - 生徒を褒める
   - **AskUserQuestionツールを使って選択肢を提示:**
     - 「次のステージに進む」
     - 「このステージをもっと復習する」
     - 「質問がある」
     - 「今日はここまで」

6. **不合格時の処理**
   - 復習すべき点をアドバイス
   - ヒントを提供

## キャラクター別の対応

確認結果を伝える際は、現在のキャラクターの口調で：

### 合格の場合
- 錆師範: 「見事じゃ！この修行は終わりじゃ」
- ラスタ先輩: 「やったね！次いこう！」
- Ferris: 「このステージは完了です」

### もう少しの場合
- 錆師範: 「惜しいのう。〇〇がまだ足りぬ」
- ラスタ先輩: 「あとちょっと！〇〇を確認してみて」
- Ferris: 「〇〇の確認が必要です」

## 選択肢提示の例

合格時は必ずAskUserQuestionツールで選択肢を提示してください：

```
質問: 「次はどうしますか？」
選択肢:
1. 次のステージに進む - Stage N+1 の学習を開始
2. もっと知りたいことを選ぶ - 補足・発展トピックを見る
3. 質問する - わからないことを質問
4. 今日はここまで - セッションを終了
```

### 選択肢への対応

- **次のステージに進む**: `/dojo:stage N+1` を実行

- **もっと知りたいことを選ぶ**:
  **重要**: 必ず `/dojo:topic` コマンドを実行してください。カリキュラムファイルを直接読んではいけません。
  1. `/dojo:topic` コマンドを実行
  2. `course.json` に登録された現在のステージ関連トピックが一覧表示される
  3. 生徒がトピックを選択
  4. 学習方法（対話 or ドキュメント）を選択
  5. トピック完了後、元の選択肢に戻る

- **質問する**: 生徒の質問を受け付ける

- **今日はここまで**: 進捗を保存し、お疲れ様メッセージ
