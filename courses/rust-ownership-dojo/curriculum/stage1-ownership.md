# Stage 1: 所有権（Ownership）

## 目標

このステージを完了すると、生徒は：
- Rustの所有権システムの基本概念を理解できる
- 値のムーブとコピーの違いを理解できる
- スコープとドロップの仕組みを理解できる
- 所有権ルールを説明できる

## 前提知識

- Rust基礎コース完了（変数、関数、構造体の理解）
- メモリの基本概念（スタック/ヒープの概念があれば尚可）

## 関連する発展トピック（サブクエスト）

このステージをクリアした後、以下のトピックで深く学べます：
- **ownership-deep-dive** - 所有権の詳細とムーブセマンティクス

## 教え方ガイド

### 導入（なぜこれを学ぶか）

所有権はRustの最も特徴的な機能であり、メモリ安全性をガベージコレクション無しで実現する仕組みです。これを理解することで、Rustがどのようにメモリ管理の安全性と効率性を両立しているかが分かります。

### 説明の流れ

1. **所有権の3つのルール**
   - 各値には所有者（owner）が存在する
   - 所有者は常に1つだけ
   - 所有者がスコープを抜けると値は破棄される

2. **ムーブセマンティクス**
   ```rust
   let s1 = String::from("hello");
   let s2 = s1;  // s1からs2に所有権がムーブ
   // println!("{}", s1);  // エラー！s1はもう使えない
   ```

3. **コピー可能な型**
   ```rust
   let x = 5;
   let y = x;  // 整数はコピー
   println!("{} {}", x, y);  // 両方使える
   ```

4. **スコープとドロップ**
   ```rust
   {
       let s = String::from("hello");
       // sを使う
   } // ここでsがドロップされる
   ```

### よくある間違い

- ムーブ後の変数を使おうとする → コンパイルエラー
- 所有権とコピーの違いを理解していない → String vs i32の違いを説明
- スコープの概念が曖昧 → ブロックと変数の生存期間を明確に

## 演習課題

### 課題1: ムーブの確認
文字列をある変数から別の変数にムーブし、元の変数が使えなくなることを確認してください。

### 課題2: 所有権を意識した関数
文字列を引数に取る関数を作り、所有権がどう移動するか観察してください。

### 課題3: Copyトレイトの確認
整数型とString型で所有権の挙動が異なることを確認してください。

## 評価基準

以下がすべて満たされたらステージクリア：

- [ ] 所有権の3つのルールを説明できる
- [ ] ムーブとコピーの違いを理解している
- [ ] 所有権に関するコンパイルエラーを読み解ける
- [ ] 簡単な所有権の問題を解決できる

## ヒント集

### ヒント1（軽め）
所有権のルールは、「一つの値には一人の所有者」という原則から始まります。

### ヒント2（中程度）
String型はヒープメモリを使うため所有権がムーブしますが、i32のような基本型はスタックにコピーされます。

### ヒント3（具体的）
```rust
fn takes_ownership(s: String) {
    println!("{}", s);
} // sがここでドロップ

fn main() {
    let s = String::from("hello");
    takes_ownership(s);
    // println!("{}", s);  // エラー！sは既にムーブされた
}
```

## 補足・発展トピック

### トピック1: なぜ所有権が必要か？

**質問**: 所有権システムがないと何が問題なの？

**説明**:
所有権がないと、以下の問題が起こりえます：
- ダングリングポインタ（解放済みメモリへの参照）
- ダブルフリー（同じメモリを2回解放）
- データ競合（複数スレッドからの同時書き込み）

Rustの所有権システムは、これらの問題をコンパイル時に防ぎます。

### 参考リンク

- The Rust Book: https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html
- Rust By Example: https://doc.rust-lang.org/rust-by-example/scope/move.html
