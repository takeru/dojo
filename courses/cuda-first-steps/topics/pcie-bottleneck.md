# トピック: なぜ転送は遅いのか

## メタ情報

- **ID**: pcie-bottleneck
- **難易度**: 初級
- **所要時間**: 3-5分（対話形式）/ 1-2分（読み物）
- **カテゴリ**: ハードウェア

## 前提知識

- Stage 5完了

## このトピックで学べること

- PCIeバスの仕組み
- GPU内部メモリとの帯域幅の違い
- 転送がボトルネックになる理由

## 関連ステージ

- Stage 5: メモリ転送のコストを知る

## 要点（ドキュメント形式用）

CPUとGPUは**PCIeバス**で接続されています。

### 構造

```
CPU [DDRメモリ] <---PCIeバス---> GPU [HBM/GDDRメモリ]
                 (ボトルネック)
```

### 帯域幅の比較

| 接続 | 帯域幅 |
|------|--------|
| PCIe 3.0 x16 | 約12 GB/秒（片方向） |
| PCIe 4.0 x16 | 約25 GB/秒（片方向） |
| GPUメモリ内部 | 数百GB/秒〜1 TB/秒 |

### 数字で見る差

- GPU内部メモリ: **900 GB/秒**（RTX 3090の例）
- PCIe 3.0: **12 GB/秒**

GPUの内部は**75倍速い**のに、PCIeがボトルネックになります。

### 実効速度

理論値より遅いのが普通：
- PCIe 3.0 x16 理論値: 15.8 GB/秒
- 実効速度: 6-10 GB/秒

オーバーヘッドやプロトコルのせいで、理論値は出ません。

## 対話形式の教え方ガイド（先生用）

### 導入

「なんでデータ転送がこんなに遅いの？」

### 説明の流れ

1. **CPU-GPU間の物理的な接続**
   - PCIeスロットでつながっている
   - マザーボード上の配線

2. **帯域幅を数字で比較**
   - GPU内部: 数百GB〜1TB/秒
   - PCIe: 12-25GB/秒
   - 何十倍も差がある

3. **結論**
   「GPUは速いけど、データを運ぶのが遅い」
   → 転送を減らすのが大事

## クリア条件（オプション）

- [ ] PCIeがボトルネックになることを理解
- [ ] GPU内部メモリとの速度差を把握

## 補足情報

### 世代による違い

| 世代 | 片方向帯域幅 |
|------|-------------|
| PCIe 3.0 x16 | 約12 GB/秒 |
| PCIe 4.0 x16 | 約25 GB/秒 |
| PCIe 5.0 x16 | 約50 GB/秒 |

新しい世代でも、GPU内部メモリには追いつきません。

### 参考リンク

- [PCI Express - Wikipedia](https://en.wikipedia.org/wiki/PCI_Express)
- [NVIDIA GPU Memory Bandwidth](https://www.nvidia.com/en-us/geforce/)
