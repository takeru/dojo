# Stage 3: 変数と型

## 目標

このステージを完了すると、生徒は：
- 変数を宣言・初期化できる
- `let` キーワードと可変性（`mut`）を理解できる
- Rustの基本型（整数、浮動小数点数、真偽値、文字列）を使い分けられる
- 型推論の仕組みを理解できる

## 前提知識

- Stage 1-2完了（環境とHello Worldの経験）
- プログラミングの基本概念（変数、型）

## 関連する発展トピック（サブクエスト）

このステージをクリアした後、以下のトピックで深く学べます（`/dojo:topic` で一覧表示）：
- **immutability-reasoning** - デフォルト不変の理由
- **shadowing** - シャドーイング
- **type-inference** - 型推論の仕組み
- **numeric-suffixes** - 数値リテラルのサフィックス
- **signed-unsigned** - 符号付きと符号なし整数
- **float-pitfalls** - 浮動小数点数の注意点

## 教え方ガイド

### 導入（なぜこれを学ぶか）

Rustの最大の特徴の一つは「デフォルト不変」です。ほとんどのプログラミング言語とは異なり、Rustでは変数はデフォルトで不変（変更不可）です。これはバグを減らし、コードの意図を明確にするための設計です。また、Rustの型システムは非常に強力で、型チェッカーがあなたのコードの多くの間違いを事前に防いでくれます。

### 説明の流れ

1. **変数の基本 - `let` キーワード**
   ```rust
   let x = 5;
   println!("x = {}", x);
   ```
   - `let` は変数を宣言
   - 型は自動推論される（型推論）
   - デフォルトは不変

2. **可変変数 - `mut` キーワード**
   ```rust
   let mut x = 5;
   x = 6;  // OK
   println!("x = {}", x);
   ```
   - `mut` をつけると可変に
   - 変更可能になる

3. **型の明示**
   ```rust
   let x: i32 = 5;
   let y: f64 = 3.14;
   let flag: bool = true;
   let ch: char = 'A';
   ```
   - `: 型名` で型を明示
   - 通常は型推論で十分

4. **基本型の紹介**

   **整数型** - ビット数によって異なる：
   - `i8, i16, i32, i64, i128` - 符号付き（負数を含む）
   - `u8, u16, u32, u64, u128` - 符号なし（0以上のみ）
   - `isize, usize` - システム依存（ポインタと同じサイズ）
   - デフォルトは `i32`

   **浮動小数点数型**:
   - `f32, f64` - 単精度、倍精度
   - デフォルトは `f64`

   **真偽値**:
   - `bool` - `true` または `false`

   **文字**:
   - `char` - シングルクォートで囲む（`'A'`）
   - Unicodeの単一文字

5. **演算と型の相互作用**
   ```rust
   let x = 5;      // i32
   let y = 2.5;    // f64
   // let z = x + y;  // エラー！型が異なる
   let z = (x as f64) + y;  // 型変換
   ```
   - Rustは暗黙的な型変換をしない
   - `as` キーワードで明示的に変換

### よくある間違い

- 不変変数に再代入 → `mut` が必要
- 型が異なるなか演算 → 型変換が必要
- 整数と浮動小数点数を混ぜる → 型推論が失敗するか、型変換が必要
- シングルクォートで複数文字 → `char` は単一文字のみ

## 演習課題

### 課題1: 基本的な変数
新しいRustプロジェクトを作成し、以下を実装してください：
```rust
fn main() {
    let name = "Rust";
    let age = 15;
    println!("{} is {} years old", name, age);
}
```

### 課題2: 可変変数
可変変数を使って、数字を変更してから出力してください：
```rust
fn main() {
    let mut count = 0;
    count = count + 1;
    count = count + 1;
    println!("Count: {}", count);
}
```

### 課題3: 複数の型
異なる型の変数を宣言して出力してください：
- 整数（`i32`）
- 浮動小数点数（`f64`）
- 真偽値（`bool`）
- 文字（`char`）

### 課題4: 型変換
整数と浮動小数点数を足し合わせてください（型変換を使用）：
```rust
fn main() {
    let x: i32 = 5;
    let y: f64 = 2.5;
    let result = (x as f64) + y;
    println!("Result: {}", result);
}
```

## 評価基準

以下がすべて満たされたらステージクリア：

- [ ] `let` で不変変数を宣言できた
- [ ] `let mut` で可変変数を宣言して変更できた
- [ ] 異なる型の変数を正しく宣言できた
- [ ] 型推論が正しく機能することを確認できた
- [ ] 型変換（`as`）を使った演算ができた

## ヒント集

### ヒント1（軽め）
変数を宣言するには `let` キーワードを使います。デフォルトは不変です。変更したければ `mut` をつけましょう。

```rust
let x = 5;       // 不変
let mut y = 10;  // 可変
```

### ヒント2（中程度）
型の明示や型変換について疑問があれば、以下の例を参考にしてください：

```rust
// 型推論
let x = 5;  // i32 と推論される

// 型の明示
let y: f64 = 5.0;

// 型変換
let a: i32 = 5;
let b: f64 = a as f64;
```

### ヒント3（具体的）
整数と浮動小数点数を足し合わせる場合、必ず型変換が必要です。以下の手順で進めてください：

```rust
fn main() {
    let x: i32 = 10;
    let y: f64 = 3.5;

    // 方法1: i32をf64に変換
    let result1 = (x as f64) + y;
    println!("Result 1: {}", result1);

    // 方法2: 最初からf64で宣言
    let x_float = x as f64;
    let result2 = x_float + y;
    println!("Result 2: {}", result2);
}
```

## 参考リンク

- The Rust Book: https://doc.rust-lang.org/book/ch03-02-data-types.html
- Rust by Example: https://doc.rust-lang.org/rust-by-example/primitives.html
