# Stage 4: 関数

## 目標

このステージを完了すると、生徒は：
- `fn` キーワードで関数を定義できる
- 関数に引数を渡せる
- 関数から値を返せる
- 戻り値の型を指定できる
- Rustの式と文の違いを理解できる

## 前提知識

- Stage 1-3完了（環境、Hello World、変数と型）
- 関数の基本概念（引数、戻り値）

## 関連する発展トピック（サブクエスト）

このステージをクリアした後、以下のトピックで深く学べます：
- **rust-closures** - クロージャとその応用（計画中）
- **rust-higher-order** - 高階関数（計画中）

## 教え方ガイド

### 導入（なぜこれを学ぶか）

関数はプログラムの基本的な構成要素です。Rustでは関数の定義が非常にシンプルです。また、Rustの関数は「式」を重視する言語であり、関数は値を返す表現（式）として機能します。これにより、関数型プログラミングなど高度な技法がサポートされています。

### 説明の流れ

1. **関数の基本 - 戻り値なし**
   ```rust
   fn greet() {
       println!("Hello!");
   }

   fn main() {
       greet();
   }
   ```
   - `fn` キーワードで定義
   - `()` 内に引数を指定
   - `{}` 内に処理を記述

2. **引数を受け取る関数**
   ```rust
   fn greet(name: &str) {
       println!("Hello, {}!", name);
   }

   fn main() {
       greet("Rust");
   }
   ```
   - 引数は `名前: 型` で指定
   - 複数の引数はカンマで区切る

3. **戻り値がある関数**
   ```rust
   fn add(x: i32, y: i32) -> i32 {
       x + y
   }

   fn main() {
       let result = add(5, 3);
       println!("{}", result);  // 8
   }
   ```
   - `-> 戻り値の型` で戻り値の型を指定
   - 最後の式が戻り値（`;` をつけない）

4. **文と式の違い**
   ```rust
   // 文（statement）- 値を返さない
   let x = 5;

   // 式（expression）- 値を返す
   let y = {
       let x = 5;
       x + 1
   };
   println!("{}", y);  // 6
   ```
   - 文の末尾には `;` をつける
   - 式の末尾には `;` をつけない
   - 関数の戻り値は式である

5. **複数の引数**
   ```rust
   fn subtract(a: i32, b: i32) -> i32 {
       a - b
   }

   fn multiply(x: f64, y: f64) -> f64 {
       x * y
   }
   ```
   - 型がそれぞれ異なる場合も明示

6. **戻り値なしを明示**
   ```rust
   fn print_number(n: i32) {
       println!("Number: {}", n);
   }

   // または

   fn print_number(n: i32) -> () {
       println!("Number: {}", n);
   }
   ```
   - 戻り値がない場合は `-> ()` で表現（普通は省略）

### よくある間違い

- 戻り値の型を指定し忘れ → コンパイルエラーまたは型推論失敗
- 戻り値の式に `;` をつける → 値が返らない（戻り値が `()` になる）
- 戻り値の型と実際の戻り値が異なる → 型チェックエラー
- 引数の型を指定し忘れ → コンパイルエラー（Rustは引数の型を推論しない）

## 演習課題

### 課題1: 基本的な関数
以下の関数を定義して、呼び出してください：
```rust
fn greet(name: &str) {
    println!("Hello, {}!", name);
}

fn main() {
    greet("Rust");
    greet("World");
}
```

### 課題2: 戻り値がある関数
2つの数字を受け取り、その合計を返す関数を作成してください：
```rust
fn add(x: i32, y: i32) -> i32 {
    x + y
}

fn main() {
    let result = add(5, 3);
    println!("5 + 3 = {}", result);
}
```

### 課題3: 複数の関数
以下の関数を実装してください：
- `multiply(a: i32, b: i32) -> i32` - 掛け算
- `divide(a: i32, b: i32) -> i32` - 割り算（整数除算）
- 各関数を呼び出して結果を表示

### 課題4: 式の活用
以下の式を使った関数を実装してください：
```rust
fn max(a: i32, b: i32) -> i32 {
    if a > b { a } else { b }
}

fn main() {
    println!("{}", max(10, 5));  // 10
    println!("{}", max(3, 8));   // 8
}
```

## 評価基準

以下がすべて満たされたらステージクリア：

- [ ] 引数なしの関数を定義・呼び出しできた
- [ ] 引数ありの関数を定義・呼び出しできた
- [ ] 戻り値のある関数を定義・呼び出しできた
- [ ] 複数の引数と戻り値を正しく処理できた
- [ ] 文と式の違いを理解して使い分けられた

## ヒント集

### ヒント1（軽め）
関数を定義するには `fn` キーワードを使います。引数には型を指定する必要があります。

```rust
fn my_function(x: i32) {
    println!("{}", x);
}
```

### ヒント2（中程度）
戻り値がある場合は、関数の定義で `-> 型` を指定します。戻り値は最後の式で表現し、`;` をつけないことが重要です。

```rust
fn add(x: i32, y: i32) -> i32 {
    x + y  // <- ; をつけない！
}

fn add_wrong(x: i32, y: i32) -> i32 {
    x + y;  // <- ; をつけると戻り値が () になる
}
```

### ヒント3（具体的）
戻り値の型チェックエラーが出ている場合は、以下の手順で確認してください：

```rust
fn get_number() -> i32 {
    // 戻り値の型が指定されているので、i32 を返さないといけない
    42  // i32 型の値
}

fn get_number_wrong() -> i32 {
    42.5  // これは f64 型なのでエラー
}

fn get_number_fixed() -> f64 {
    42.5  // 戻り値の型をf64に変更
}
```

## 参考リンク

- The Rust Book: https://doc.rust-lang.org/book/ch03-03-how-functions-work.html
- Rust by Example: https://doc.rust-lang.org/rust-by-example/fn.html
