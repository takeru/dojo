# トピック: シャドーイング

## メタ情報

- **ID**: shadowing
- **難易度**: 初級
- **所要時間**: 5-8分（対話形式）/ 2-3分（読み物）
- **カテゴリ**: 変数・型

## 前提知識

- Stage 3完了（変数と型）
- `let` キーワードの使い方

## このトピックで学べること

- シャドーイングとは何か
- 再代入との違い
- シャドーイングで型を変更できること
- 実際の使用場面

## 関連ステージ

- Stage 3: 変数と型（ここで登場）

## 要点（ドキュメント形式用）

### シャドーイングとは

同じ名前で新しい `let` 文を使うことを「シャドーイング」と呼びます。これは前の変数を隠して、新しい変数を作ります。

```rust
let x = 5;
let x = x + 1;  // x を 6 に再定義
let x = x * 2;  // x を 12 に再定義
println!("{}", x);  // 12
```

### 再代入との違い

**再代入（mut）**:
```rust
let mut x = 5;
x = 6;  // 同じ変数を変更
```

**シャドーイング**:
```rust
let x = 5;
let x = 6;  // 新しい変数を作成
```

### 型も変えられる

シャドーイングは新しい変数なので、型も変更できます：

```rust
let x = "five";     // 文字列
let x = 5;          // 整数に変更
let x = 5.5;        // 浮動小数点数に変更
```

これは `mut` では不可能です（型は固定）：

```rust
let mut x = "five";
x = 5;  // エラー！型が違う
```

### 実際の使用場面

**1. 変換パイプライン**:
```rust
let input = "42";
let input = input.trim();        // 空白削除
let input = input.parse().unwrap();  // 数値に変換
println!("{}", input + 10);  // 52
```

**2. 一時的な変換**:
```rust
let spaces = "   ";
let spaces = spaces.len();  // 文字列 → 数値
```

## 対話形式の教え方ガイド（先生用）

### 導入

「おや、同じ変数名で何度も `let` を使っておるのう？これは『シャドーイング』という強力な機能じゃ」

なぜこれを知っておくと便利か：
- 変数名を使い回せる（新しい名前を考えなくて済む）
- 型を変更できる
- 変換パイプラインが読みやすくなる

### 説明の流れ

1. **基本的なシャドーイング**
   「まず簡単な例を見てみるのじゃ」
   ```rust
   let x = 5;
   println!("x = {}", x);
   let x = 10;
   println!("x = {}", x);
   ```
   「実行してみるのじゃ。どうなる？」

2. **再代入との違いを示す**
   「これは `mut` での再代入とは違うのじゃ」
   ```rust
   // mut: 同じ変数
   let mut y = 5;
   y = 10;

   // shadowing: 新しい変数
   let x = 5;
   let x = 10;
   ```

3. **型変更の実演**
   「シャドーイングの真価はここじゃ。型まで変えられるぞ」
   ```rust
   let text = "hello";
   let text = text.len();  // 文字列 → 数値
   println!("{}", text);
   ```

4. **実用例**
   「実際のプログラムではこんな風に使うのじゃ」
   ```rust
   let input = "  42  ";
   let input = input.trim();
   let input: i32 = input.parse().unwrap();
   println!("数値: {}", input);
   ```

### 実践課題（オプション）

1. 文字列を数値に変換するプログラムをシャドーイングで書く
2. 温度変換（華氏→摂氏）でシャドーイングを使う

## クリア条件（オプション）

理解度チェック：
- [ ] シャドーイングと再代入の違いを説明できる
- [ ] シャドーイングで型を変更できることを理解している
- [ ] 実際にシャドーイングを使ったコードを書ける

## 補足情報

### スコープとの関係

シャドーイングはスコープに影響されます：

```rust
let x = 5;
{
    let x = 10;
    println!("内側: {}", x);  // 10
}
println!("外側: {}", x);  // 5
```

### mutとの使い分け

- **mut**: 同じ型で値を変更し続ける場合
- **shadowing**: 型を変えたり、変換パイプラインを作る場合

### 参考リンク

- The Rust Book: https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html#shadowing
