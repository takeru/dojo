# トピック: デフォルト不変の理由

## メタ情報

- **ID**: immutability-reasoning
- **難易度**: 初級
- **所要時間**: 8-10分（対話形式）/ 3-5分（読み物）
- **カテゴリ**: 変数・型

## 前提知識

- Stage 3完了（変数と型）
- `let` と `mut` の基本

## このトピックで学べること

- なぜRustはデフォルトで不変なのか
- 不変性がもたらす4つの利点
- Rustの設計思想

## 関連ステージ

- Stage 3: 変数と型（ここで登場）
- Stage 7以降: マルチスレッドで重要性が増す

## 要点（ドキュメント形式用）

### なぜRustはデフォルトで不変なの？

これはRustの最大の設計思想です。

### 4つの利点

**1. バグを減らす**
予期しない変更を防ぎます。

```rust
let x = 5;
// ... 100行のコード ...
println!("{}", x);  // 確実に5
```

**2. 意図を明確にする**
`mut` があれば「この変数は変わる」と即座にわかります。

```rust
let count = 0;       // 変わらない
let mut total = 0;   // 変わる可能性
```

**3. マルチスレッド対応**
不変なデータは複数スレッドで安全に共有できます。

```rust
let message = "Hello";
// 複数スレッドから読める（安全）
```

**4. 最適化**
コンパイラが不変性を使って最適化できます。

### 他の言語との比較

| 言語 | デフォルト |
|------|-----------|
| JavaScript | 可変 |
| Python | 可変 |
| Java | 可変 |
| **Rust** | **不変** |

Rustは「変更できる」ではなく「変更する必要がある」と明示させます。

### 実例

**悪い例（他言語のパターン）**:
```javascript
let count = 0;
// ... 多くのコード ...
count++;  // どこで変わったか追いにくい
```

**良い例（Rustのパターン）**:
```rust
let mut count = 0;
// mutがあるので、変わる可能性を認識
count += 1;
```

## 対話形式の教え方ガイド（先生用）

### 導入

「Rustの最大の特徴の一つが『デフォルト不変』じゃ。これは他の言語とは真逆の発想なのじゃ」

なぜこれが重要か：
- バグの多くは「予期しない変更」から生まれる
- Rustはそれを言語レベルで防ぐ

### 説明の流れ

1. **問題提起**
   「他の言語では、変数は勝手に変更されてしまうのじゃ」

   例を見せる（擬似コード）:
   ```
   x = 5
   // ... 1000行後 ...
   x = 10  // いつ変わった？
   ```

2. **Rustの解決策**
   「Rustでは、変更するには `mut` が必要じゃ」
   ```rust
   let x = 5;
   // x = 10;  // エラー！

   let mut y = 5;
   y = 10;  // OK
   ```

3. **利点を体感させる**
   「コードを読むときを想像してみるのじゃ」
   ```rust
   let config = load_config();
   // ... 100行のコード ...
   use_config(config);  // configは変わっていない保証
   ```

4. **マルチスレッドへの布石**
   「将来、複数の処理を同時に走らせるとき、不変性が大活躍するぞ」

### 実践課題（オプション）

1. 意図的に不変変数を変更しようとしてエラーを確認
2. mutの使用箇所を減らすリファクタリング

## クリア条件（オプション）

理解度チェック：
- [ ] デフォルト不変の4つの利点を説明できる
- [ ] mutを使うべき場面と使わない場面を判断できる
- [ ] 不変性がバグ防止にどう役立つか理解している

## 補足情報

### 関数型プログラミングの影響

Rustのデフォルト不変は、関数型プログラミング言語（Haskell、OCamlなど）から影響を受けています。

### const との違い

```rust
const MAX: i32 = 100;  // コンパイル時定数
let x = 5;             // 実行時の不変変数
```

- `const`: コンパイル時に値が確定
- `let`: 実行時に値が確定（ただし変更不可）

### 参考リンク

- The Rust Book: https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html
- Rust設計思想: https://doc.rust-lang.org/book/ch00-00-introduction.html
