# トピック: リリースビルドとデバッグビルド

## メタ情報

- **ID**: release-build
- **難易度**: 初級
- **所要時間**: 5-10分（対話形式）/ 2-3分（読み物）
- **カテゴリ**: ビルド・最適化

## 前提知識

- Stage 2完了（Hello World）
- cargo runの基本的な使い方

## このトピックで学べること

- デバッグビルドとリリースビルドの違い
- いつどちらを使うべきか
- 実行速度の違いを体感

## 関連ステージ

- Stage 2: Hello World（ここで登場）
- Stage 5以降: パフォーマンスが重要になる

## 要点（ドキュメント形式用）

Rustには2つのビルドモードがあります：

### デバッグビルド（デフォルト）

```bash
cargo build        # または
cargo run
```

**特徴**:
- ✅ コンパイルが速い
- ✅ デバッグ情報が含まれる
- ❌ 最適化されていない（実行が遅い）
- 📍 用途: 開発中

**生成場所**: `target/debug/`

### リリースビルド

```bash
cargo build --release
cargo run --release
```

**特徴**:
- ❌ コンパイルに時間がかかる
- ✅ 最適化される（実行が速い）
- ✅ バイナリサイズが小さい
- 📍 用途: 本番環境、ベンチマーク

**生成場所**: `target/release/`

### 実行速度の違い

簡単なプログラムでも、リリースビルドは**数倍から数十倍速い**ことがあります。

| ビルドモード | コンパイル時間 | 実行速度 |
|-------------|--------------|---------|
| デバッグ | 速い | 遅い |
| リリース | 遅い | 速い |

### 使い分けの基準

- **開発中**: デバッグビルド（`cargo run`）
- **性能測定**: リリースビルド（`cargo run --release`）
- **本番配布**: リリースビルド（`cargo build --release`）

⚠️ **重要**: パフォーマンスを測るときは必ず `--release` を使いましょう！

## 対話形式の教え方ガイド（先生用）

### 導入

「cargo buildには、実は2つのモードがあるのじゃ。『デバッグ』と『リリース』じゃ。これを使い分けることが大切なのじゃ」

なぜこれを知っておくと便利か：
- 本番用の速い実行ファイルを作れる
- パフォーマンス測定で正しい結果が得られる
- 開発中は速くコンパイルできる

### 説明の流れ

1. **まずデバッグビルドを確認**
   ```bash
   cd workspace/hello_world
   time cargo run
   ```
   「これがデフォルトの『デバッグビルド』じゃ」

2. **リリースビルドを試させる**
   ```bash
   time cargo run --release
   ```
   「今度は `--release` をつけたぞ。コンパイルに時間がかかったじゃろう？」

3. **生成物のサイズを比較**
   ```bash
   ls -lh target/debug/hello_world
   ls -lh target/release/hello_world
   ```
   「リリース版の方が小さくなっておるのう」

4. **実行速度の違いを体感（ループプログラム作成）**
   簡単なループプログラムを作って比較：
   ```rust
   fn main() {
       let mut sum = 0u64;
       for i in 0..100_000_000 {
           sum += i;
       }
       println!("Sum: {}", sum);
   }
   ```

   ```bash
   time cargo run           # デバッグ
   time cargo run --release # リリース
   ```
   「リリース版は圧倒的に速いじゃろう？これが最適化の力じゃ」

### 実践課題（オプション）

1. 簡単な計算処理をするプログラムを書く
2. デバッグとリリースでそれぞれビルド・実行
3. 実行時間を比較して、違いを体感する

## クリア条件（オプション）

理解度チェック：
- [ ] デバッグビルドとリリースビルドの違いを説明できる
- [ ] リリースビルドのコマンドが分かる
- [ ] どういう時にリリースビルドを使うべきか分かる

## 補足情報

### なぜリリースビルドは速いのか？

コンパイラが様々な最適化を行うからです：
- インライン展開
- デッドコード削除
- ループの最適化
- SIMD命令の活用
- など

### Cargo.tomlでカスタマイズ

最適化レベルをカスタマイズすることもできます：

```toml
[profile.dev]
opt-level = 1  # デバッグでも少し最適化

[profile.release]
opt-level = 3  # 最大限最適化（デフォルト）
lto = true     # リンク時最適化
```

### 参考リンク

- Cargo Book - Profiles: https://doc.rust-lang.org/cargo/reference/profiles.html
